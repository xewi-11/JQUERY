<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="js/jquery-3.7.1.js"></script>
</head>
<body>
    <h1>Crud de departamentos</h1>
    <label >id Departamentos</label>
    <input type="text" id="cajaid" /><br>
    <label >Nombre</label>
    <input type="text" id="cajanombre" /><br>
    <label >Localidad</label>
    <input type="text" id="cajalocalidad" /><br>
    <button id="btnInsert">Insertar</button>
    <button id="btnUpdate">Actualizar</button>
    <button id="btnDelete">Borrar</button>
    <table id="tablaDepartamentos" style="border-radius: 20PX; border: 2px solid black;">
        <thead>
            <tr>
                <th>IdDepartamento</th>
                <th>Nombre</th>
                <th>Localidad</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
    <script>
        let url="https://apicruddepartamentosxml.azurewebsites.net/";
       
        $(document).ready(function(){
         cargarTabla();
         $("#btnInsert").click(function(){
            let id=$("#cajaid").val();
            let nombre=$("#cajanombre").val();
            let localidad=$("#cajalocalidad").val();
            let dataXML="<Departamento>";
             dataXML+="<IdDepartamento>"+id+"</IdDepartamento>";
             dataXML+="<Nombre>"+nombre+"</Nombre>";
             dataXML+="<Localidad>"+localidad+"</Localidad>";
             dataXML+="</Departamento>";
             let request="api/departamentos";
             $.ajax({
                url:url+request,
                type: "POST",
                contentType:"text/xml",
                data:dataXML,
                success:function(){
                    console.log("Insertado");
                    cargarTabla();
                }
             })
         })
         $("#btnUpdate").click(function(){
            let id=$("#cajaid").val();
            let nombre=$("#cajanombre").val();
            let localidad=$("#cajalocalidad").val();
            let dataXML=getDepartamentoXML(id,nombre,localidad);
            let request="api/departamentos";

            $.ajax({
                url:url+request,
                type:"PUT",
                contentType:"text/xml",
                data:dataXML,
                success:function(){
                    console.log("Modificado");
                    cargarTabla();
                }
            })
         })
         $("#btnDelete").click(function(){
            let id=$("#cajaid").val();
            let request="api/departamentos/"+ id;
            $.ajax({
                url:url+request,
                type:"DELETE",
                success:function(){
                    console.log("Eliminando")
                    cargarTabla();
                }
            })
         })
        })
         function cargarTabla(){
         var request="api/departamentos";
         $.get(url+request,function(data){
            console.log("Leyendo servicio");
            var html="";
            $(data).find("Departamento").each(function(){
                var id=$(this).find("IdDepartamento").first().text();
                var nombre=$(this).find("Nombre").first().text();
                var localidad=$(this).find("Localidad").first().text();
                html+="<tr >";
                html+=" <td style='border: 2px solid black;'> "+ id+"</td>";
                html+=" <td style='border: 2px solid black;'> "+ nombre+"</td>";
                html+=" <td style='border: 2px solid black;'> "+ localidad+"</td>";
                html+="</tr>";
            })
            $("#tablaDepartamentos tbody").html(html);
         })
    }
    function getDepartamentoXML(id,nombre,localidad){
        let dataXML="<Departamento>";
             dataXML+="<IdDepartamento>"+id+"</IdDepartamento>";
             dataXML+="<Nombre>"+nombre+"</Nombre>";
             dataXML+="<Localidad>"+localidad+"</Localidad>";
             dataXML+="</Departamento>";
             return dataXML;
    }
    </script>
    
</body>
</html>